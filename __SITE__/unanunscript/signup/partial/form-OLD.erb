<%
=begin

  Formulaire d'inscription au programme UAUS
  C'est un simple envoi au paiement paypal.

=end

site.all_meta      << 'http-equiv="X-UA-Compatible" content="IE=edge"'
site.all_javascript << 'https://www.paypalobjects.com/api/checkout.js'

env_mod = :sandbox # pour le moment
montant = '0.01'
%>
<h2>S’inscrire au programme UN AN UN SCRIPT</h2>

<%=
if param(:operation) == 'uaus_signup'
  debug "Inscription demandée"
end
%>


<form
  action="https://www.paypal.com/cgi-bin/webscr"
  method="POST" target="_top">
    <input type="hidden" name="cmd" value="_s-xclick">
    <input type="hidden" name="hosted_button_id" value="KYDY2ARKYSLFS">
    <input type="hidden" name="os0" value="<%= montant %>">
    <input
      type="image"
      name="submit"
      src="https://www.paypalobjects.com/fr_FR/FR/i/btn/btn_paynowCC_LG.gif"
      border="0"
      alt="PayPal, paiement en ligne">
    <img
      src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif"
      alt="PayPal"
      border="0"
      width="1" height="1">
</form>


<div id="paypal-button-container"></div>

<script type="text/javascript">

  paypal.Button.render({

    env: <%= env_mod == :sandbox ? 'sandbox' : 'production' %>,

    // PayPal Client IDs - replace with your own
    // Create a PayPal app: https://developer.paypal.com/developer/applications/create
    client: {
        sandbox:    'AkuWUSRU-LKPQGbkHp1E8CrwkR2cAwiPbK6CWSc4fkpEYAIcb5wepjrM',
        production: 'AYhLJ1TCqLmZb5FTJ9Y-i7c2Asu-AUPS659.GRfIsfvuB40KL5o0SLK5'
    },

    // Show the buyer a 'Pay Now' button in the checkout flow
    commit: true,

    // payment() is called when the button is clicked
    payment: function(data, actions) {

      // Make a call to the REST api to create the payment
      return actions.payment.create({
        payment: {
          transactions: [
            { amount: { total: '<%= montant %>', currency: 'EUR' } }
          ]
        }
      });
    },

    // onAuthorize() is called when the buyer approves the payment
    onAuthorize: function(data, actions) {
      // Make a call to the REST api to execute the payment
      return actions.payment.execute().then(function() {
          window.alert('Payment Complete!');
      });
    }

  }, '#paypal-button-container');

</script>
